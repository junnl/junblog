{{ define "main" }}
<div class="waterfall-container">
  <div class="waterfall-grid" id="waterfall-grid">
    {{ $pages := where .Site.RegularPages "Type" "!=" "page" }}
    {{ range $index, $page := $pages.ByDate.Reverse }}
    <article class="waterfall-item" data-index="{{ $index }}">
      <a href="{{ $page.RelPermalink }}" class="item-link">
        <!-- Cover Image -->
        <div class="item-image">
          {{ with $page.Params.cover }}
          <!-- 1. æ‰‹åŠ¨æŒ‡å®šçš„å°é¢å›¾ -->
          <img src="{{ . | relURL }}" alt="{{ $page.Title }}" loading="lazy">
          {{ else }}
          <!-- 2. ä½¿ç”¨ Picsum éšæœºå›¾ç‰‡ä½œä¸ºé»˜è®¤å°é¢ -->
          {{- $seed := $page.File.UniqueID | default $page.Title -}}
          {{- $height := index (slice 200 160 180 220 150 190) (mod $index 6) -}}
          <img src="https://picsum.photos/seed/{{ $seed }}/400/{{ $height }}" alt="{{ $page.Title }}" loading="lazy" class="placeholder-image">
          {{ end }}
        </div>

        <!-- Overlay Content -->
        <div class="item-overlay">
          <!-- Category Badge (clickable) -->
          {{ with $page.Section }}
          <a href="{{ "/" | relURL }}{{ . | urlize }}/" class="item-category" onclick="event.stopPropagation();">{{ . }}</a>
          {{ end }}

          <!-- Title (clickable) -->
          <h3 class="item-title">
            <a href="{{ $page.RelPermalink }}" class="item-title-link">{{ $page.Title }}</a>
          </h3>

          <!-- Summary -->
          <p class="item-summary">
            {{ with $page.Description }}
              {{ . | truncate 60 }}
            {{ else }}
              {{ $page.Summary | plainify | truncate 60 }}
            {{ end }}
          </p>

          <!-- Meta: Date only -->
          <div class="item-meta">
            <time datetime="{{ $page.Date.Format "2006-01-02" }}">
              {{ $page.Date.Format "2006-01-02" }}
            </time>
          </div>
        </div>
      </a>
    </article>
    {{ end }}
  </div>

  {{ if eq (len $pages) 0 }}
  <div class="empty-state">
    <div class="empty-icon">ðŸ“­</div>
    <p>æš‚æ— æ–‡ç« ï¼Œæ•¬è¯·æœŸå¾…...</p>
  </div>
  {{ end }}
</div>
{{ end }}

